' Gambas class file

' Innova Project - Launcher of APP
'
' Copyright (C) Herberth GuzmÃ¡n
'
' This program is free software; you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation; either version 2 of the License, or
' (at your option) any later version.
'
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License
' along with this program; if not, write to the Free Software
' Foundation, Inc., 51 Franklin St, Fifth Floor,
' Boston, MA  02110-1301  USA

' Homepage: http://http://sourceforge.net/projects/innovadesktop

Private $sLastName As String

Private sPath As String
Public sDir As String = Desktop.GetDirectory("DESKTOP") & "/" 'M_XDG_DIR.spath_desktop & "/"
Public sLanguage As String = ((Left(System.Language, 2)))

Private $MX As Integer
Private $MY As Integer
Public sPath_Source As String 
Public sPath_Destination As String 
Public sName_Paste As String 
Public sName_Copy As String 

Public Settings_Core_Innova As New Settings(Desktop.ConfigDir &/ "Innova/Innova_Config.conf")

Public Item_Menu_Link As Menu

Private dm As New DesktopMime  
Private df As DesktopFile  
Private $df As DesktopFile[]
Private i As Integer
Private pr As Process
Private $hWatcher As DesktopWatcher
Private $hWatch As Watcher
Private sPC As String
Private sTrash As String
Public MovingButton As Integer

Public Sub _new()
  
  M_Theme.Show_Theme
  
  'With $hWatcher = New DesktopWatcher(Me) As "MyDTWatcher"
  '  .RootWindow = True
  'End With
  
  $hWatcher = New DesktopWatcher(True) As "MyDTWatcher"
  
  'If $bWatch Then $hWatcher = New Watcher(Me) As "Watcher"
  '$hWatcher = New DesktopWatcher(If(True, X11.RootWindow, 0)) As "MyDTWatcher"
  
  ''M_Launcher_Show.Main
  ''recuperar X11.SetWindowProperty(f_wallpaper.Id, Atom["_NET_WM_STATE"], Atom["ATOM"], Atom[" _NET_WM_STATE_BELOW"])
  X11.SetWindowProperty(f_wallpaper.Id, Atom["_NET_WM_WINDOW_TYPE"], Atom["ATOM"], Atom["_NET_WM_WINDOW_TYPE_DESKTOP"])
  
End

Public Sub MyDTWatcher_Change()
  
  'Print "1"
  
End

Public Sub MyDTWatcher_Windows()
  
  'RefreshViewAfter
  'Reload
  
  'Show_Files_Desktop
  'RefreshViewLater()
End

Public Sub MyDTWatcher_ActiveWindow()
  
  'ivwDesktop.Refresh
  'Wait
  'Show_Files_Desktop
  ' Print "3"
  
End

Public Sub Show_Files_Desktop()
  
  Dim sFiles As String
  Dim iSize_Icon As Integer = M_Var_Global.iSize_Icons_View 
  Dim i As Integer
  Dim img As Image
  Dim PicWall As Picture
  Dim pIcon As Picture
  Dim DesktopEntry As DesktopFile
  Dim $Files As String[]
  Dim iSize As Integer
  Dim iTam As Integer
  Dim iResult_iSize_Icons As Integer 
  Dim iResult_Icons_Line As Integer 
  
  ivwDesktop.Clear
  
  If (iSize_Icon > 64) Then
    iSize_Icon = iSize_Icon / 1.5
  Endif
  Settings_Core_Innova.Reload
  
  Try iResult_iSize_Icons = Settings_Core_Innova["Desktop/Icon_Size_Desktop"]
  Try iResult_Icons_Line = Settings_Core_Innova["Desktop/IconLine_Desktop"]
  
  If Not IsNull(iResult_iSize_Icons) Then
    M_Var_Global.iSize_Icons_View = iResult_iSize_Icons
  Endif
  
  If Not IsNull(iResult_Icons_Line) Then
    ivwDesktop.IconLines = iResult_Icons_Line
  Endif
  
  sPC = Settings_Core_Innova["Desktop/Show_Icon_PC"]
  sTrash = Settings_Core_Innova["Desktop/Show_Icon_Trash"]
  
  'iSize = M_Var_Global.iSize_Icons_View 
  
  If (sPC = "1") Then
    Inc i
    ''ivwDesktop.Add(i & "System", ("System"), Picture["icon:/" & iSize_Icon & "/computer"])
    Try ivwDesktop.Add("System", ("System"), Picture["icon:/" & iSize_Icon & "/computer"])
  Endif
  
  If (sTrash = "1") Then
    Inc i    
    Try ivwDesktop.Add("Trash", ("Trash"), Picture["icon:/" & iSize_Icon & "/trash"])
  Endif
  
  $Files = Dir(sDir, "*.png")
  $Files.Insert(Dir(sDir, "*.jpg"))
  $Files.Insert(Dir(sDir, "*.jpeg"))
  $Files.Insert(Dir(sDir, "*.bmp"))
  $Files.Insert(Dir(sDir, "*.gif"))
  $Files.Insert(Dir(sDir, "*.xpm"))
  
  For Each sFiles In Dir(sDir) '.Sort(gb.Natural)
    If IsDir(sDir &/ sFiles) Then
      'ivwDesktop.Add(i & sFiles, sFiles, Picture["icon:/" & iSize_Icon & "/directory"]).Editable = Access(sDir, gb.Write)
      ivwDesktop.Add(sFiles, sFiles, Picture["icon:/" & iSize_Icon & "/directory"]).Editable = Access(sDir, gb.Write)
    Endif
  Next
  
  For Each sFiles In Dir(sDir, "*", gb.File)
    Inc i
    img = DesktopMime.FromFile(sDir &/ sFiles).GetIcon(iSize_Icon)
    
    If Not (InStr(sFiles, ".desktop")) Then
      
      If Not (InStr(sFiles, ".jpg") Or InStr(sFiles, ".png") Or InStr(sFiles, ".bmp") Or InStr(sFiles, ".jpeg") Or InStr(sFiles, ".gif") Or InStr(sFiles, ".xpm")) Then
        'ivwDesktop.Add(i & sFiles, sFiles, img.Picture).Editable = Access(sDir, gb.Write)
        Try ivwDesktop.Add(sFiles, sFiles, img.Picture).Editable = Access(sDir, gb.Write)
      Endif
      
    Else
      DesktopEntry = New DesktopFile(sDir &/ sFiles)
      'pIcon = M_DesktopEntry[DesktopEntry.Path, iSize_Icon]
      pIcon = M_DesktopEntry[DesktopEntry.Path, iSize_Icon].Image.Stretch(iSize_Icon, iSize_Icon).Picture
      'ivwDesktop.Add(i & sFiles, sFiles, pIcon).Editable = Access(sDir, gb.Write)
      Try ivwDesktop.Add(sFiles, DesktopEntry.Name, pIcon).Editable = Access(sDir, gb.Write)
    Endif
    
  Next
  
  For Each sFiles In $Files
    Inc i
    PicWall = Picture[sDir &/ sFiles]
    iTam = (iSize_Icon * PicWall.Height) \ PicWall.Width
    PicWall = Picture[sDir &/ sFiles].Image.Stretch(iSize_Icon, iTam).Picture
    Print sFiles
    'ivwDesktop.Add(i & sFiles, sFiles, PicWall)
    Try ivwDesktop.Add(sFiles, sFiles, PicWall)
    
  Next
  
  'ivwDesktop.Add(i & sFiles, sFiles, Picture["icon:/" & iSize_Icon & "/directory"]).Editable = Access(sDir, gb.Write)
  'Catch
  
End

Public Sub Form_Open()
  
  Dim sResult_Desktop_Wall As Integer 
  Dim sResult_Desktop_Wall_Rand As String 
  Dim iResult_iSize_Icons As Integer 
  Dim sResult_Pos As String 
  Dim sResult_WM As String 
  Dim sResult_Rnd_True As Integer 
  Dim sResult_Dir_Wallpaper_Desktop_Random As String
  
  TimerWallRand.Start()
  M_Theme.Show_Theme
  m_core.Show_Active_Time_Wallpaper_Rnd
  
  panView.Resize(Desktop.w / 2, Desktop.H - f_panel.H / 2)
  Try sResult_Pos = Settings_Core_Innova["Panel/Panel_Position", f_panel]
  If (sResult_Pos = "Top") Then
    
    ivwDesktop.y = Desktop.y + f_panel.H 
    
  Endif
  
  Try iResult_iSize_Icons = Settings_Core_Innova["Desktop/Icon_Size_Desktop"]
  
  If Not IsNull(iResult_iSize_Icons) Then
    M_Var_Global.iSize_Icons_View = iResult_iSize_Icons
  Endif
  
  Show_Files_Desktop
  
  With ivwDesktop
    ' .IconSize = M_Var_Global.iSize_Icons_View
    ' .Dir = sDir
    .Background = Color.Transparent
  End With
  
  ' M_Transparent.Transparent
  
  Try sResult_WM = Settings_Core_Innova["Session_Windows_Manager/Windows_Manager", f_wallpaper]
  
  If sResult_WM = "kwin" Then
    f_wallpaper.FullScreen = True
    Me.Maximized = True ''
    Me.Width = Desktop.Width ''
    Me.Height = Desktop.Height ''
  Else  
    'Me.FullScreen = True
    Me.Maximized = True
    Me.Width = Desktop.Width
    Me.Height = Desktop.Height
  Endif
  
  'M_Core.Randomize_Wallpaper
  
  ' Try sResult_Rnd_True = Settings_Core_Innova["Desktop/Wallpaper_Desktop_Random", f_settings]
  ''recuperarTry sResult_Dir_Wallpaper_Desktop_Random = Settings_Core_Innova["Desktop/Dir_Wallpaper_Desktop_Random", f_settings]
  
  ' If (sResult_Rnd_True = "1") Then
  '   Try sResult_Desktop_Wall_Rand = Settings_Core_Innova["Desktop/Image_Wallpaper_Desktop_Random", f_wallpaper]
  '   f_wallpaper.img_Fondo.Picture = Picture[sResult_Dir_Wallpaper_Desktop_Random &/ sResult_Desktop_Wall_Rand]
  '   img_Fondo.Refresh
  '   Wait 0.5
  
  ' Print sResult_Dir_Wallpaper_Desktop_Random &/ sResult_Desktop_Wall_Rand
  ''recuperarTry sResult_Desktop_Wall = Settings_Core_Innova["Desktop/Wallpaper_Desktop", f_wallpaper]
  ''recuperarIf Not IsNull(sResult_Desktop_Wall) Then
  '' recuperarf_wallpaper.img_Fondo.Picture = Picture[sResult_Desktop_Wall]
  ''recuperarEndif
  
  ''recuperarTry sResult_Desktop_Wall_Rand = Settings_Core_Innova["Desktop/Image_Wallpaper_Desktop_Random", f_wallpaper]
  ''recuperarIf Not IsNull(sResult_Desktop_Wall_Rand) Then
  ''recuperarM_Core.Randomize_Wallpaper
  ''recuperarf_wallpaper.img_Fondo.Picture = Picture[sResult_Dir_Wallpaper_Desktop_Random &/ sResult_Desktop_Wall_Rand]
  ''recuperarimg_Fondo.Refresh
  ''recuperarTimerWallRand.Start
  ''recuperarPrint sResult_Dir_Wallpaper_Desktop_Random &/ sResult_Desktop_Wall_Rand
  'recuperar Else
  'recuperar  TimerWallRand.Start
  'recuperar Endif
  
  ''recuperarEndif
  
  Me.SetFocus
  
  ' If IsNull(Clipboard.Clear) Then
  'mnuPaste.Enabled = False
  'Endif
  
End

Public Sub Form_MouseDown()
  
  $MX = Mouse.ScreenX - Me.X
  $MY = Mouse.ScreenY - Me.Y
  
End

Public Sub Form_MouseMove()
  
  If Mouse.Left Then Me.Move(Mouse.ScreenX - $MX, Mouse.ScreenY - $MY)
  
End

Public Sub Create_Apps_Link()
  
  Dim sMimeType As String
  Dim i As Integer
  
  sPath = sDir &/ ivwDesktop.Item.Text
  sMimeType = DesktopMime.FromFile(sPath).Type
  mnuOpenwith.Children.Clear
  
  For Each df In DesktopFile.FromMime(DesktopMime.FromFile(sPath).Type)
    Inc i
    
    Item_Menu_Link = New Menu(mnuOpenwith) As "Items" 
    Item_Menu_Link.text = df.Name
    Item_Menu_Link.Picture = df.GetIcon(16).Picture
    Item_Menu_Link.Tag = i 
    
  Next
  
Catch
  
End

Public Sub Items_Click()
  
  sPath = sDir &/ ivwDesktop.Item.Text
  
  With df = DesktopFile.FromMime(DesktopMime.FromFile(sPath).Type)[Last.tag - 1]  
    df.Run(sPath)
  End With
  
End

Private Sub runDesktopFile(sPath As String)
  
  Dim sDesktopFile As New DesktopFile(sPath)
  Dim $CmdArray As String[] = Split(sDesktopFile.Exec, " ", "")
  
  Try Shell $CmdArray[0]
  
End

Public Sub Form_Close()
  
  Stop Event
  'f_wallpaper.Show
  
End

Public Sub New_Folder()
  
  Dim sResult As String
  Dim sRes As String
  
  While sResult = Null
    sResult = InputBox("Folder name", ("New Folder"), ("New Folder"))
    
    If Exist(sDir &/ sResult) Then  
      Message(LC_MESSAGES.MSG_INF_FOLDER_EXIST)
    Endif
    
    Try Mkdir sDir &/ sResult
    
    If sResult = Null
      sRes = Message.Question(("Enter a Name..."), ("Ok"), ("Cancelar"))
      If sRes = 2
        Break
      Else
        Try Mkdir sDir &/ sResult
        
      Endif
    Endif
    
  Wend 
  mnuRefresh_Click
Catch
  
  Message.Error(("Cannot create directory.") & "\n\n" & Error.Text)
  
End

Public Sub mnuNewFile_Click()
  
  Dim sResult As String
  Dim sRes As String
  Dim hFile As File
  
  While sResult = Null
    sResult = InputBox("New File", ("New File"), ("New File"))
    
    If Exist(sDir &/ sResult) Then
      
      Message(LC_MESSAGES.MSG_INF_FILE_EXIST)
    Endif
    
    Try hFile = Open sDir &/ sResult For Create
    
    If sResult = Null
      sRes = Message.Question((LC_MESSAGES.MSG_QUESTION_RES_NEW_FILE), ("Ok"), ("Cancelar"))
      If sRes = 2
        Break
      Else
        Try hFile = Open sDir &/ sResult For Create
        '   File_Desktop
      Endif
    Endif
    
  Wend 
  mnuRefresh_Click
  
End

Public Sub mnuSelectall_Click()
  
  ivwDesktop.SelectAll
  
End

Public Sub ivwDesktop_Select()
  
  $sLastName = ivwDesktop.Item.Text
  
  If ivwDesktop.Item.Text Then sName_Copy = ivwDesktop.Item.Text
  Create_Apps_Link
  
  If ivwDesktop.Item.Text = Null Then
    $sLastName = Null
  Endif
  
  If (ivwDesktop.Item.Key = "System") Or (ivwDesktop.Item.Key = "Trash") Then 
    mnucopy.Visible = False
    mnutrash.Visible = False
    mnuDelete.Visible = False
    mnuOpenwith.Visible = False
    mnucompress.Visible = False
  Else
    mnucopy.Visible = True
    mnutrash.Visible = True
    mnuDelete.Visible = True
    mnuOpenwith.Visible = True
    mnucompress.Visible = True
  Endif
  
  If $sLastName Like "*.tar.gz" Or If $sLastName Like "*.tar.bz2" Or If $sLastName Like "*.tgz" Or If $sLastName Like "*.tar" Or If $sLastName Like "*.zip" Then
    
    mnuUncompress.Visible = True
    mnucompress.Visible = False
    
  Else
    
    mnucompress.Visible = True
    mnuUncompress.Visible = False
    
  Endif
  
Catch
  
End 

Public Sub ivwDesktop_KeyPress()
  
  If (Key.Code = Key.Enter) Or (Key.Code = Key.Return) Then
    ivwDesktop_DblClick
  Endif
  
  If (Key.Code = Key.Delete) Or (Key.Code = Key.Del) Then
    mnuDelete_Click
  Endif
  
  If (Key.Code = Key.Esc) Then
    ivwDesktop.UnselectAll
    $sLastName = Null
  Endif
  
End

Private Sub GetSelection() As String[]
  
  Dim hView As Object
  Dim aSel As New String[]
  
  If ivwDesktop.Visible Then
    hView = ivwDesktop
  Endif
  
  ivwDesktop.MoveFirst
  While ivwDesktop.Available
    If ivwDesktop.Item.Selected Then
      aSel.Add(ivwDesktop.Item.Text)
    Endif
    ivwDesktop.MoveNext
  Wend
  
  Return aSel
  
End

Private Sub GetSelection_fDesktop() As String[]
  
  Dim hView As Object
  Dim aSel As New String[]
  
  If ivwDesktop.Visible Then
    hView = ivwDesktop
  Endif
  
  ivwDesktop.MoveFirst
  While ivwDesktop.Available
    If ivwDesktop.Item.Selected Then
      'aSel.Add(ivwDesktop.Current)
      aSel.Add(ivwDesktop.Item.Key)
    Endif
    ivwDesktop.MoveNext
  Wend
  
  Return aSel
  
End

Public Sub mnucopy_Click_Origi()
  
  Dim strFiles As String[]
  Dim strData As String
  Dim strFile As String
  Dim sType As String = "text/uri-list"
  
  strFiles = GetSelection()
  If strFiles.Count > 0 Then
    For Each strFile In strFiles
      strFile = sDir &/ strFile
      strData = strData & strFile & "\n"
    Next
    strFiles.Clear()
    strFiles = Null
    Clipboard.Copy(strData, sType)
    
  Endif
  
End

Public Sub mnucopy_Click()
  
  Dim strFiles As String[]
  Dim strData As String
  Dim strFile As String
  Dim sType As String = "text/uri-list"
  
  strFiles = GetSelection()
  If strFiles.Count > 0 Then
    
    For Each strFile In strFiles
      
      strFile = sDir &/ strFile
      strData = strData & strFile & "\n"
    Next
    strFiles.Clear()
    strFiles = Null
    Clipboard.Copy(strData, sType)
    
  Endif
  
End

Public Sub mnuRefresh_Click()
  
  application.busy = 1
  ivwDesktop.Clear
  'Wait
  
  Show_Files_Desktop
  application.busy = 0
  'Wait
  
End

Public Sub mnulink_Click()
  
  Dim I As Integer
  Dim sName As String
  Dim sExt As String
  
  Inc i
  sName = File.BaseName(sDir & ivwDesktop.Item.Text)
  sExt = File.Ext(sDir & ivwDesktop.Item.Text)
  
  If sExt = Null Then
    Link sDir & ivwDesktop.Item.Text To sDir & sName & "_" & i & sExt
  Else
    Link sDir & ivwDesktop.Item.Text To sDir & sName & "_" & i & "." & sExt
  Endif
  
End

Public Sub mnuRefresh1_Click()
  
  mnuRefresh_Click
  
End

Public Sub ivwDesktop_DblClick()
  
  Dim sResult_FM As String 
  'Dim sfiles As String
  Dim sFM As String
  Dim sCurrent As String
  Dim sLastCurrent As String
  
  sLastCurrent = $sLastName
  
  Try sResult_FM = Settings_Core_Innova["Panel_Command/File_Manager", f_panel]
  
  If IsDir(sDir &/ ivwDesktop.Item.Text) Then
    'Exec [sResult_FM, ivwDesktop.Dir &/ ivwDesktop.Current]   
    Exec [sResult_FM, sDir &/ sLastCurrent]   
  Else
    
    'If File.Ext(ivwDesktop.Item.Text) = "desktop" Then
    If ivwDesktop.Item.Key Ends "desktop" Then 
      'runDesktopFile(sDir &/ ivwDesktop.Item.Key)
      DesktopApps_Desk[File.BaseName(ivwDesktop.Item.Key)].Exec() 
      
    Else
      Desktop.Open(sDir &/ sLastCurrent)
    Endif
    
  Endif
  
  If File.Ext(sLastCurrent) = "gambas" Or File.Ext(sLastCurrent) = "sh" Or File.Ext(sLastCurrent) = "bin" Then
    Shell ("./" & sLastCurrent)
  Endif
  
  'If (sLastCurrent = "System") Or (sLastCurrent = "1System") Then
  If (ivwDesktop.Item.Key = "System") Then
    Exec [sResult_FM, "/"]  
  Endif
  
  If (ivwDesktop.Item.Key = "Trash") Then
    sFM = (sResult_FM)
    If sFM = "Dolphin" Then
      sCurrent = ("trash:/")
      Exec [sFM, sCurrent] 
    Else
      sCurrent = ("trash:///")
      Exec [sFM, sCurrent] 
    Endif
  Endif
  
Catch
  
End

Public Sub mnuProperties_Click()
  
  f_properties.Show
  f_properties.Move(Mouse.ScreenX, Mouse.ScreenY)
  f_properties.FilePropertiesDesktop.Path = sDir
  
End

Public Sub Properties_Mixed()
  
  Dim strFiles As String[]
  Dim strData As String
  Dim strFile As String
  Dim calcSum As Integer = 0
  
  strFiles = GetSelection()
  If strFiles.Count > 0 Then
    
    For Each strFile In strFiles
      
      strFile = sDir &/ strFile
      strData = strData & strFile & "\n"
      
      With Stat(strFile)
        calcSum += Str(.Size) 
      End With
      
    Next
    
    f_properties_mixed.Show
    f_properties_mixed.Move(Mouse.ScreenX, Mouse.ScreenY) 
    f_properties_mixed.lblName.Text = ("Multiple Files")
    f_properties_mixed.lbltype.Text = ("Files of different types")
    f_properties_mixed.lbldir.Text = File.Dir(Stat(strFile).Path)
    f_properties_mixed.lbluser.Text = Stat(strFile).User
    f_properties_mixed.lblsize.Text = getText(calcSum)
    
  Endif
  
  ''bueno f_properties.Show
  ''bueno   f_properties.Move(Mouse.ScreenX, Mouse.ScreenY)
  ''bueno f_properties.FilePropertiesDesktop.Path = sDir
  
  'f_properties.x = f_wallpaper.X 
  'f_properties.y = f_wallpaper.y
  
End

Public Sub mnuProperties1_Click()
  
  Dim strFiles As String[]
  'Dim strData As String
  'Dim strFile As String
  
  ' If (strFiles.Count > 0) Then
  '   Properties_Mixed
  ' Endif
  
  If (ivwDesktop.Item.Key = "System") Then
    Shell "/usr/bin/PCInfo.gambas"
  Else
    
    '  f_properties.Show
    '  f_properties.Move(Mouse.ScreenX, Mouse.ScreenY)
    '  f_properties.FilePropertiesDesktop.Path = sDir &/ $sLastName
    
    strFiles = GetSelection()
    
    If strFiles.Count > 1 Then
      
      Properties_Mixed
    Else
      
      f_properties.Show
      f_properties.Move(Mouse.ScreenX, Mouse.ScreenY)
      f_properties.FilePropertiesDesktop.Path = sDir &/ $sLastName
      
    Endif
  Endif
  'Catch
  
End

Public Sub mnucompress_Click()
  
  f_compress.Show
  f_compress.txtfilename.Text = ivwDesktop.Current.Text
  
End

Public Sub mnucompress_Click001()
  
  Dim Cp As New Compress
  Dim sPath_Tmp As String
  Dim sName As String
  'Dim sDir As String
  Cp.Type = "zlib"
  sName = ivwDesktop.Item.Text
  sName = URLDecode(sName)
  
  'Print sDir &/ ivwDesktop.Item.Text
  
  ' If IsDir(sDir &/ sName) Then
  'Print sDir & sName
  '   Cp.Fil(sDir &/ sName, sDir &/ File.BaseName(sName) & ".gz", Cp.Max)
  ' Endif
  
  Cp.Type = "zlib"
  Cp.File(User.Home &/ "mio", User.Home &/ "test.gz", Cp.Max)
  
  ' sPath_Tmp = Mid$(sDir &/ sName, RInStr(sDir &/ sName, "/") + 1) 'sacamos el nombre del directorio de la ruta
  ' Shell "cp -R " & sDir &/ sName & " " & "/tmp"  'COPIO EL DIRECTORIO EN USER.HOME Y LISTO
  ' Shell "cd " & sDir &/ " ;tar -c " & sPath_Tmp &/ " | bzip2 > " & sPath_Tmp & ".tar.bz2" 'COMPRIMIMOS EL ARCHIVO
  ' Else
  'Cp.Type = "zlib"
  ''   Cp.File(sDir &/ sName, sDir &/ File.BaseName(sName) & ".gz", Cp.Max)
  '  ivwDesktop.Reload
  ' Endif 
  
  'comando = "cd /tmp/pintascreenGuarda/;tar czvf \"" & File.Name(rutafichero) & ".tar.gz\" *"
  
End

Public Sub mnucompress_Click002()
  
  Dim Cp As New Compress
  Dim sPath_Tmp As String
  Dim sName As String
  Dim sDir As String
  
  sName = ivwDesktop.Item.Text
  sName = URLDecode(sName)
  
  If IsDir(sDir &/ sName) Then
    
    sPath_Tmp = Mid$(sDir &/ sName, RInStr(sDir &/ sName, "/") + 1) 'sacamos el nombre del directorio de la ruta
    Shell "cp -R " & sDir &/ sName & " " & "/tmp"  'COPIO EL DIRECTORIO EN USER.HOME Y LISTO
    Shell "cd " & sDir &/ " ;tar -c " & sPath_Tmp &/ " | bzip2 > " & sPath_Tmp & ".tar.bz2" 'COMPRIMIMOS EL ARCHIVO
  Else
    Cp.Type = "zlib"
    Cp.File(sDir &/ sName, sDir &/ File.BaseName(sName) & ".gz", Cp.Max)
    '  ivwDesktop.Reload
  Endif 
  '  mnuRefresh_Click
  
End

Public Sub ivwDesktop_Menu()
  
  'Dim sFile_Select As String = ivwDesktop.Item.Text
  Dim sValue As String
  Dim sType As String = "text/uri-list"
  
  sValue = Clipboard.Paste(sType)
  If Not sValue Then 
    mnuPaste.Enabled = False
  Else
    mnuPaste.Enabled = True
  Endif
  
  If IsNull(ivwDesktop.Item.Text) Then
    
    mnuPopup2.Popup
    
  Else
    mnuPopup.Popup
  Endif
Catch
  
End

Public Sub mnuopen2_Click()
  
  m_core.Show_Home_Desktop
  
End

Public Sub mnupcinfo_Click()
  
  'f_pcinfo.Show
  
  'Shell User.Home &/ "PCInfo.gambas"
  Shell "/usr/bin/PCInfo.gambas"
  
End

Public Sub mnuMyInnova_Click()
  
  'Shell User.Home &/ "QSettings.gambas"
  Shell "/usr/bin/QSettings.gambas"
  
End

Public Sub mnuWidget_Click()
  
  'f_settings.Show
  'f_settings.IconPanelInnova.Index = 5 
  'Shell User.Home &/ "QSettings.gambas"
  Shell "/usr/bin/QSettings.gambas"
  
End

Public Sub menuWallpaper_Click()
  
  f_conf_wallpaper.Show
  
End

Public Sub mnuabout2_Click()
  
  f_about_dist.ShowModal
  'f_about_edulibreos.ShowModal
  
End

Public Sub mnuFolder_Click()
  
  New_Folder
  
End

Private Function URLDecode_Original(sURL As String) As String
  
  Dim i As Integer                 
  Dim ch As String                
  Dim digits As String
  Dim modifiedURL As String = ""
  
  i = 1
  Do While i <= Len(sURL)
    
    ch = Mid$(sURL, i, 1)
    If ch = "+" Then
      
      modifiedURL = modifiedURL & " "
    Else If ch <> "%" Then
      
      modifiedURL = modifiedURL & ch
    Else If i > Len(sURL) - 2 Then
      modifiedURL = modifiedURL & ch
    Else
      
      digits = Mid$(sURL, i + 1, 2)
      
      modifiedURL = modifiedURL & Chr$(CInt(Val("&" & digits)))
      
      i += 2
    Endif
    Inc i
  Loop
  
  Return modifiedURL
  
End

Public Sub Form_Arrange()
  
  Me.Center
  img_Fondo.Move(Me.x, Me.y, Me.W, Me.H)
  
End

Public Sub mnuDelete_Click()
  
  Dim strFiles As String[]
  Dim strData As String
  Dim strFile As String
  Dim sType As String = "text/uri-list"
  Dim sKey As String
  
  'Try sKey = ivwDesktop.Item.Key
  
  ' Print sKey
  
  ' If (InStr(sKey, ".desktop")) Then
  strFiles = GetSelection_fDesktop()
  
  ' Else
  '   strFiles = GetSelection()
  ' Endif
  
  If strFiles.Count > 0 Then
    Select Message.Question((LC_MESSAGES.MSG_QUESTION_WRITE_FILE_EXIST), ("&Yes"), ("&No"))
      Case 1
        
        For Each strFile In strFiles
          
          ' If (InStr(strFile, ".desktop")) Then
          Print Str$(strFile)
          strFile = sDir &/ strFile
          strData = strData & strFile & "\n"
          If Not IsDir(strFile) Then 
            Try Kill strFile
          Else
            Shell "rm -rf " & Shell$(strFile)
          Endif  
          
          ' Endif
          'Print strFile
          
          'Endif
          '  Print strFile
        Next
      Case 2
        ivwDesktop.UnselectAll
        
    End Select
    
    strFiles.Clear()
    strFiles = Null
    
  Endif
  
  mnuRefresh_Click
  
  'Catch
  
  ''Kill_Files
  
End

Public Sub Kill_Files()
  
  Dim strFiles As String[]
  Dim strFile As String
  
  If Not Access(ivwDesktop.Dir, gb.Write) Then
    Message.Info(LC_MESSAGES.MSG_INF_DEL_FILE)
    Return
  Endif
  
  strFiles = ivwDesktop.Item.Text
  If strFiles.Count > 0 Then
    
    Select Message.Question((LC_MESSAGES.MSG_QUESTION_WRITE_FILE_EXIST), ("&Yes"), ("&No"))
      Case 1
        
        For Each strFile In strFiles
          
          Shell "rm -rf " & Shell$(sDir &/ strFile)
          
          'Wait 
          
          ivwDesktop.Refresh
          Wait
        Next
      Case 2
        ivwDesktop.UnselectAll
        
        ivwDesktop.Refresh
        Wait
    End Select
  Endif
  
  strFiles.Clear()
  strFiles = Null
  
  ivwDesktop.Refresh
  
End

Public Sub mnuOpen_Click()
  
  ivwDesktop_DblClick
  
End

Public Sub mnuOpenwith_Click()
  
  'If mouse.Left Then
  Create_Apps_Link
  
  'Endif
  
End

Static Public Sub Decode(Path As String) As String
  
  Dim iInd As Integer
  Dim sRes As String
  Dim sCar As String
  
  For iInd = 1 To Len(Path)
    sCar = Mid$(Path, iInd, 1)
    If sCar = "%" Then 
      sCar = Chr$(Val("&H" & Mid$(Path, iInd + 1, 2)))
      iInd += 2
    Else If sCar = "+" Then 
      sCar = " "
    Endif
    sRes &= sCar
  Next
  
  Return sRes  
  
End

Static Private Function URLDecode(txt As String) As String
  ''' Descodifica los caracteres hexadecimales en las URI's recorriendo la cadena dada
  ''' Params: txt la URI a descodificar
  ''' Return: la URI descodificada
  
  Dim txt_len As Integer
  Dim i As Integer
  Dim ch As String
  Dim digits As String
  Dim resultado As String
  
  resultado = ""
  txt_len = Len(txt)
  i = 1
  Do While i <= txt_len
    ' Examinar el siguiente caracter
    ch = Mid$(txt, i, 1)
    If ch = "+" Then
      ' Convertir a espacio
      resultado = resultado & " "
    Else If ch <> "%" Then
      ' Normal, no cambiar
      resultado = resultado & ch
    Else If i > txt_len - 2 Then
      resultado = resultado & ch
    Else
      ' Obtener los siguientes caracteres hex.
      digits = Mid$(txt, i + 1, 2)
      ' Debug digits
      ' aquÃ­ convertimos el valor hexadecimal a entero y
      ' se lo pasamos a Chr que devuelve el carÃ¡cter correcto.
      resultado = resultado & Chr$(CInt(Val("&" & digits)))
      i = i + 2
    Endif
    i = i + 1
  Loop
  
  Return resultado
  
End

Public Sub mnuPaste_Clickori()
  
  Dim a As String
  Dim b As String[]
  Dim sDir As String
  Dim sCopy As String
  Dim sResult As String
  
  Dim aarchivos As New String[]  
  Dim unarchivo As String
  Dim incrementos As Float
  
  sDir = Desktop.GetDirectory("DESKTOP") 'M_XDG_DIR.sPath_DESKTOP
  a = Clipboard.Paste("text/uri-list") ' limitamos el tipo de los datos pegados
  b = Split(a, gb.CrLf, "", True) ' cargamos la lista de rutas en un array b
  ' escapando las terminaciones de lÃ­nea
  a = Null  ' reutilizamos la variable "a"
  
  f_progressbar.Show
  f_progressbar.ProgressBar1.Value = 0
  If sDir Then
    unarchivo = a
    incrementos = 1 / b.Count
    
    For Each a In b
      a = Right$(a, -7) ' quitamos "file://";
      a = URLDecode(a)  ' descodificamos las cadenas
      a = RTrim(a)
      
      If Exist(sDir &/ File.Name(a)) Then
        Message.Title = ("Innova Desktop - Copy File")
        If Message.Question("<span style=\"color:#" & "0000FF" & ";margin-left:1em;\">" & ("There is already a file with the same name in this location.  ") & "</span>" & "<b><span style=\"color:#" & "088906" & ";margin-left:1em;\">" & UCase(File.Name(a)) & "</span></b>" & "<span style=\"color:#" & "CC0000" & ";margin-left:1em;\">" & (" Overwrite it with the new file?"), ("Copy and Replace"), ("Don't Copy")) = 1 Then
          Kill sDir &/ File.Name(a)
        Endif
      Endif
      
      If Not IsDir(a) Then 
        Try Copy a To sDir &/ File.Name(a)
      Else
        f_progressbar.ProgressBar1.Value += incrementos
        f_progressbar.lblStatus.Text = "Copiando " & unarchivo
        sCopy = "cp -R " & a & " " & sDir
        Shell sCopy Wait
      Endif 
      'f_progressbar.ProgressBar1.Value += incrementos
      ' f_progressbar.lblStatus.Text = "Copiando " & a
      Wait 0.01    
    Next
    ' Message.Info("Copia completada")
    f_progressbar.Close
  Else
    Message.Info("Faltan los directorios")
  Endif  
  
  mnuRefresh_Click
  
  'Catch
  
End

Public Sub mnuPaste_Click_Nuevo()
  
  Dim a As String
  Dim b As String[]
  Dim sDir As String
  Dim sCopy As String
  Dim sResult As String
  
  Dim aarchivos As New String[]  
  Dim unarchivo As String
  Dim incrementos As Float 
  
  Dim directoriorigen As String
  
  sDir = Desktop.GetDirectory("DESKTOP") 'M_XDG_DIR.sPath_DESKTOP
  a = Clipboard.Paste("text/uri-list") ' limitamos el tipo de los datos pegados
  b = Split(a, gb.CrLf, "", True) ' cargamos la lista de rutas en un array b
  
  ' escapando las terminaciones de lÃ­nea
  a = Null  ' reutilizamos la variable "a"
  f_progressbar.Show
  f_progressbar.ProgressBar1.Value = 0
  'incrementos = 1 / b.Count
  'b = Dir(sDir, "*", gb.File)
  ' incrementos = 1 / aarchivos.Count
  incrementos = 1 / b.Count
  For Each a In b
    a = Right$(a, -7) ' quitamos "file://";
    a = URLDecode(a)  ' descodificamos las cadenas
    a = RTrim(a)
    ' Print a
    If Exist(sDir &/ File.Name(a)) Then
      Message.Title = ("Innova Desktop - Copy File")
      If Message.Question("<span style=\"color:#" & "0000FF" & ";margin-left:1em;\">" & ("There is already a file with the same name in this location.  ") & "</span>" & "<b><span style=\"color:#" & "088906" & ";margin-left:1em;\">" & UCase(File.Name(a)) & "</span></b>" & "<span style=\"color:#" & "CC0000" & ";margin-left:1em;\">" & (" Overwrite it with the new file?"), ("Copy and Replace"), ("Don't Copy")) = 1 Then
        Kill sDir &/ File.Name(a)
      Endif
    Endif
    
    '  Private directoriorigen As String = "/home/edulibreos/mio/" 'Desktop.GetDirectory("DESKTOP")
    'Private directoriodestino As String = "/home/edulibreos/Escritorio" 'Desktop.GetDirectory("DESKTOP")
    ' directoriorigen = File.Dir(a)
    'Print directoriorigen
    'aarchivos = Dir(directoriorigen, "*", gb.File)
    'aarchivos = Dir(directoriorigen, File.Name(a), gb.File)
    'incrementos = 1 / aarchivos.Count
    
    ' For Each unarchivo In aarchivos
    
    '  Print unarchivo
    
    'f_progressbar.ProgressBar1.Value += incrementos
    'f_progressbar.lblStatus.Text = "Copiando " '& File.Name(a)
    'lblStatus.Text = "Copiando " & unarchivo
    'Wait 0.01     
    ' Para copiar, descomentar
    '      Copy directoriorigen &/ unarchivo To sDir &/ unarchivo
    'sCopy = "cp -R " & a & " " & sDir
    'Shell sCopy Wait
    'Copy directoriorigen To directoriodestino 
    
    If Not IsDir(a) Then 
      f_progressbar.ProgressBar1.Value += incrementos
      f_progressbar.lblStatus.Text = "Copiando " & a
      ' Try Copy a To sDir &/ File.Name(a)
      
    Else
      f_progressbar.ProgressBar1.Value += incrementos
      'f_progressbar.lblStatus.Text = "Copiando " & File.Name(a)
      f_progressbar.lblStatus.Text = "Copiando " & (a)
      'Print unarchivo
      'Print sDir
      Wait 0.1
      sCopy = "cp -R " & a & " " & sDir
      Shell sCopy Wait
      
      f_progressbar.ProgressBar1.Value += incrementos
      f_progressbar.lblStatus.Text = "Copiando " & a
      Wait 0.01    
      
    Endif 
    
    Wait 0.01    
    
    'Next
    
  Next
  
  mnuRefresh_Click
  
  'Catch
  
End

Public Sub TimerWallRand_Timer()
  
  Dim sResult_Desktop_Wall_Rand As String
  
  Try sResult_Desktop_Wall_Rand = Settings_Core_Innova["Desktop/Image_Wallpaper_Desktop_Random", f_wallpaper]
  
  If Not IsNull(sResult_Desktop_Wall_Rand) Then
    M_Core.Randomize_Wallpaper
    M_Core.Show_Preview_Wallpaper_RND
  Endif
  
End

Public Sub ivwDesktop_Drop()
  
  Dim a As String
  Dim b As String[]
  Dim sDir As String
  Dim sCopy As String
  
  sDir = Desktop.GetDirectory("DESKTOP") 'M_XDG_DIR.sPath_DESKTOP
  a = Drag.Paste("text/uri-list") ' limitamos el tipo de los datos pegados
  b = Split(a, gb.CrLf, "", True) ' cargamos la lista de rutas en un array b
  ' escapando las terminaciones de lÃ­nea
  a = Null  ' reutilizamos la variable "a"
  
  For Each a In b
    a = Right$(a, -7) ' quitamos "file://";
    a = URLDecode(a)  ' descodificamos las cadenas
    a = RTrim(a)
    '  Print a
    
    If Not IsDir(a) Then 
      Try Copy a To sDir &/ File.Name(a)
    Else
      sCopy = "cp -R " & a & " " & sDir
      Shell sCopy Wait
    Endif  
    
    ivwDesktop.Refresh
    
  Next
  
End

Public Sub ivwDesktop_MouseDrag()
  
  Dim cad As String
  
  sDir = Desktop.GetDirectory("DESKTOP")
  'If Mouse.left Then 
  
  If ivwDesktop.Key = Null Then Return '"" Then Return
  
  If Mouse.Left Then
    Drag.Icon = ivwDesktop.Current.Picture ' Picture["icon:/32/file"]
    'FileChooser1.Drag(FileChooser1.SelectedPath)
    ivwDesktop.Drag(sDir &/ ivwDesktop.Key, "text/uri-list.text")
  Endif
  
  ' If ivwDesktop.Count > 0 Then
  '  cad = ivwDesktop.Key
  ' Last.Drag(cad) 
  '   Drag.Icon = Stock["copy"]      
  'Endif
  
  'Drag.Icon = Last.Picture
  'Last.Drag(Drag.Icon.Image)
  'MovingButton = Val(Last.Tag)
  'ivwDesktop.Drag(sDir &/ ivwDesktop.Item.Text, "text/uri-list.text")
  
  'Message(ivwDesktop.Drag(sDir &/ ivwDesktop.Item.Text, "text/uri-list.text"))
  
  'clsFileView1.Drag(clsFileView1.Current, "text/uri-list")
  ' ivwDesktop.drag(sDir &/ ivwDesktop.Item.Text, "text/uri-list")
  '    Drag.Icon = Stock["copy"]      
  'Endif 
  'Catch
  
End

Public Sub ivwDesktop_GotFocus()
  
  If ivwDesktop.HasFocus Then
    ivwDesktop.Clear
    Show_Files_Desktop
  Endif
  
End

Public Sub ivwDesktop_MouseMove()
  
  'Dim sName As String 
  
  If Not ivwDesktop.FindAt(Mouse.x, Mouse.y) Then
    
    ' sName = ivwDesktop.item.Text
    Try $sLastName = ivwDesktop.Item.Text
  Endif
  
End

Public Sub mnuAscending_Click()
  
  If mnuAscending.Checked = True Then
    ivwDesktop.Sorted = True
    '  Else
    '    ivwDesktop.Sorted = False
  Endif
  
  If mnuAscending.Checked = False Then
    ivwDesktop.Sorted = False
    ivwDesktop.Clear
    Show_Files_Desktop
  Endif
  
  'ivwIcons.Sorted = Not ivwIcons.Sorted  
  
End

Public Sub panView_MouseDown()
  
End

Public Sub mnucut_Click()
  
  Dim strFiles As String[]
  Dim strData As String
  Dim strFile As String
  Dim sType As String = "text/uri-list"
  
  strFiles = GetSelection()
  If strFiles.Count > 0 Then
    For Each strFile In strFiles
      strFile = sDir &/ strFile
      strData = strData & strFile & "\n"
    Next
    strFiles.Clear()
    strFiles = Null
    Clipboard.Copy(strData, sType)
    
  Endif
  
  strFiles = GetSelection()
  If strFiles.Count > 0 Then
    
    For Each strFile In strFiles
      strFile = sDir &/ strFile
      strData = strData & strFile & "\n"
      
      If Not IsDir(strFile) Then 
        Try Kill strFile
      Else
        Shell "rm -rf " & Shell$(strFile)
        
      Endif  
      
    Next
    
    strFiles.Clear()
    strFiles = Null
    
  Endif
  
  mnuRefresh_Click
  
End

Public Sub ivwDesktop_Rename()
  
  Dim sOld As String
  Dim sLast As String
  
  sOld = sDir & $sLastName
  sLast = sDir & ivwDesktop.Item.Text
  Try Move sOld To sLast
  
End

Public Sub mnutrash_Click()
  
  Dim strFiles As String[]
  Dim strData As String
  Dim strFile As String
  Dim sType As String = "text/uri-list"
  Dim sOrigen As String
  Dim sDestiny As String
  
  'sOrigen = sDir & $sLastName
  sDestiny = Desktop.DataDir &/ "Trash/info"
  
  'strFiles = GetSelection 'ivwDesktop.Item.Text
  strFiles = GetSelection()
  If strFiles.Count > 0 Then
    Select Message.Question((LC_MESSAGES.MSG_QUESTION_DELETE_FILE_TRASH), ("&Yes"), ("&No"))
      Case 1
        
        For Each strFile In strFiles
          strFile = sDir &/ strFile
          strData = strData & strFile & "\n"
          Shell "mv -f " & Shell$(strFile) & " " & Desktop.DataDir &/ "Trash/info"
          'Print strFile
          'Print sDestiny
          'Move strFile To sDestiny
          'Shell "mv " & strFile & " " & Desktop.DataDir &/ "Trash/info"  'COPIO EL DIRECTORIO EN TASH
          'Shell "mv " & Shell$(strFile)
          
        Next
        
      Case 2
        ivwDesktop.UnselectAll
        
    End Select
    
    strFiles.Clear()
    strFiles = Null
    
  Endif
  
  mnuRefresh_Click
  
End

Public Sub ivwDesktop_Leave()
  
End

Public Sub mnuPaste_Click()
  
  Dim a As String
  Dim b As String[]
  Dim sDir As String
  Dim sCopy As String
  Dim sResult As String
  'Dim aarchivos As New String[]  
  'Dim unarchivo As String
  'Dim incrementos As Float
  
  Dim nFiles As Integer
  Dim sName As String
  'Dim iSize As Integer
  Dim iSize As Float
  
  sDir = Desktop.GetDirectory("DESKTOP") 'M_XDG_DIR.sPath_DESKTOP
  a = Clipboard.Paste("text/uri-list") ' limitamos el tipo de los datos pegados
  b = Split(a, gb.CrLf, "", True) ' cargamos la lista de rutas en un array b
  ' escapando las terminaciones de lÃ­nea
  a = Null  ' reutilizamos la variable "a"
  
  nFiles = 0
  nFiles = b.Count
  
  f_progressbar.Show
  f_progressbar.ProgressBar1.Value = 0
  If sDir Then
    
    For Each a In b
      a = Right$(a, -7) ' quitamos "file://";
      a = URLDecode(a)  ' descodificamos las cadenas
      a = RTrim(a)
      
      If Exist(sDir &/ File.Name(a)) Then
        Message.Title = ("Innova Desktop - Copy File")
        If Message.Question("<span style=\"color:#" & "0000FF" & ";margin-left:1em;\">" & ("There is already a file with the same name in this location.  ") & "</span>" & "<b><span style=\"color:#" & "088906" & ";margin-left:1em;\">" & UCase(File.Name(a)) & "</span></b>" & "<span style=\"color:#" & "CC0000" & ";margin-left:1em;\">" & (" Overwrite it with the new file?"), ("Copy and Replace"), ("Don't Copy")) = 1 Then
          Try Kill sDir &/ File.Name(a)
          ''Message("entre aqui")
        Endif
      Endif
      
      If Not IsDir(a) Then 
        
        sName = Left$(a, -4) ' conseguimos el nombre
        ''Exec ["convert", a, nombre & ".jpg"]  ' ejecutamos para convertir de formato
        
        f_progressbar.lblStatus2.Text = ("Copying ") & nFiles & (" Items ")
        f_progressbar.lblStatus.Text = ("Copying ") & File.Name(a) & (" To ") & sDir
        iSize = Stat(a).Size
        
        f_progressbar.lblSize.Text = getText(iSize)
        f_progressbar.ProgressBar1.Value += (1 / nFiles)
        'f_progressbar.ProgressBar1.Background = Color.RGB(100, 200, 100)
        f_progressbar.ProgressBar1.Background = &336b87& '&003B46& 'Color.RGB(201, 201, 255)
        ' f_progressbar.ProgressBar1.Foreground = Color.White
        
        Wait 0.5
        
        Try Copy a To sDir &/ File.Name(a) 
        
        'sCopy = "cp -R " & a & " " & sDir &/ File.Name(a)
        'Shell sCopy Wait
        
      Else
        sName = Left$(a, -4) ' conseguimos el nombre
        
        f_progressbar.lblStatus2.Text = ("Copying ") & nFiles & (" Items ")
        f_progressbar.lblStatus.Text = ("Copying ") & File.Name(a) & (" To ") & sDir
        iSize = Stat(a).Size
        f_progressbar.lblSize.Text = getText(iSize)
        f_progressbar.ProgressBar1.Value += (1 / nFiles) 
        f_progressbar.ProgressBar1.Background = &336b87&
        
        Wait 0.5
        sCopy = "cp -R " & a & " " & sDir
        Shell sCopy Wait
        
      Endif 
      
    Next
    ' Message.Info("Copia completada")
    f_progressbar.Hide
  Else
    Message.Info(("An unknown error has occurred."))
  Endif  
  
  mnuRefresh_Click
Catch
  
End

Private Function getText(argSize As Integer) As String
  
  If 1024 > argSize Then 'byte
    Return Format$(argSize, "##0 Byte")
  Else If 1024 ^ 2 > argSize Then 'KiB
    Return Format$(argSize / 1024, "##0.00 KB")
  Else If 1024 ^ 3 > argSize Then 'MiB
    Return Format$(argSize / (1024 ^ 2), "##0.00 MB")
  Else If 1024 ^ 4 > argSize Then 'GiB
    Return Format$(argSize / (1024 ^ 3), "##0.00 GB")
  Else If 1024 ^ 5 > argSize Then 'TiB
    Return Format$(argSize / (1024 ^ 4), "##0.00 TB")
  Else
    Return "Null"
  Endif
  
End

Public Sub mnuabout3_Click()
  
  'f_about_innova.ShowModal
  f_about.ShowModal
  
End

Public Sub mnuSelectApps_Click()
  
End
